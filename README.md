# AI Trading Agent

这是一个基于多智能体（Multi-Agent）架构的AI量化分析和交易决策框架。项目利用大型语言模型（LLM）的分析能力，结合传统金融数据（如K线、技术指标、基本面、新闻舆情），生成投资决策建议，并提供一个稳健的回测引擎来评估策略表现。

---

## 核心功能

- **多智能体协作**：项目内置多个分工明确的智能体，模拟一个专业的投研团队，各司其职。
- **配置驱动**：所有关键参数都集中在 `app_config.py` 和 `.env` 文件中管理，实现了代码与配置的分离。
- **双运行模式**：支持用于即时分析的**实时模式**和用于策略评估的**回测模式**。
- **专业的策略评估**：回测引擎提供包含总收益率、胜率、夏普比率、最大回撤等在内的关键绩效指标（KPIs）。
- **可扩展的架构**：所有Agent继承自一个通用的 `BaseAgent` 基类，为未来增加新的Agent或统一功能提供了良好的基础。

---

## 智能体（Agents）详解

本框架的核心思想是将复杂的交易决策任务分解给一组专门的Agent。每个Agent都是一个独立的Python类，拥有清晰的职责边界。

#### `DataAgent` - 数据分析师
- **职责**: 负责所有与K线和技术指标相关的任务。
- **输入**: 一个股票代码 (e.g., `AAPL`)。
- **处理**: 
  1. 通过 `yfinance` 库获取指定股票的历史日K数据。
  2. 利用 `ta` 库计算一系列常用的技术指标，包括：
     - 均线 (MA20)
     - 相对强弱指数 (RSI14)
     - MACD 指标
     - 布林带 (Bollinger Bands)
     - 随机振荡器 (Stochastic Oscillator)
     - 平均真实范围 (ATR)
  3. 将包含所有指标的结构化数据（DataFrame）转换为对LLM友好的自然语言文本。
- **输出**: 一段描述近期市场数据的文本，例如：“日期：2023-01-01，收盘价：150.00，20日均线：148.50，14日RSI：55.6...”。

#### `FinancialAgent` - 基本面分析师
- **职责**: 负责评估公司的基本面健康状况。
- **输入**: 一个股票代码。
- **处理**: 
  1. 通过 `yfinance` 库获取公司的核心财务摘要信息。
  2. 提取关键的基本面数据，如市值、市盈率(PE)、每股收益(EPS)、股息率等。
- **输出**: 一段关于公司基本面的文本摘要，例如：“公司名称: Apple Inc., 市值: 2.7T, 市盈率(PE): 28.50...”。

#### `NewsAgent` - 舆情分析师
- **职责**: 负责捕捉与公司相关的最新市场新闻和情绪。
- **输入**: 一个查询关键词（通常是公司名或股票代码）。
- **处理**: 
  1. 调用 [NewsAPI](https://newsapi.org/) 的接口，获取最新的相关新闻文章列表。
  2. 清洗每篇文章的内容，移除HTML标签和无关字符。
- **输出**: 一段格式化的新闻文本，包含多条新闻的发布时间、标题和内容摘要。

#### `RiskAgent` - 风险管理师
- **职责**: 作为一个基于规则的硬约束，对交易行为进行风险控制。
- **输入**: 当前价格、持仓成本、持仓数量。
- **处理**: 
  1. 检查当前持仓的盈亏比例。
  2. 判断是否触发了在 `app_config.py` 中预设的止盈（`take_profit_pct`）或止损（`stop_loss_pct`）条件。
- **输出**: 如果触发风控条件，则返回一个强制的`卖出`决策；否则返回`None`。

#### `DecisionAgent` - 首席投资官 (CIO)
- **职责**: 整个框架的大脑，负责整合所有信息，做出最终的交易决策。
- **输入**: 来自其他所有Agent的分析文本、历史相似行情、用户风险偏好等。
- **处理**: 
  1. 将所有输入信息动态地组合成一个结构清晰、逻辑严密的Prompt。
  2. 将该Prompt发送给在 `app_config.py` 中指定的大型语言模型（LLM）。
  3. 解析LLM返回的结构化JSON响应。
- **输出**: 一个包含具体交易指令的字典，例如：`{"decision": "买入", "reason": "...", "confidence": 0.85, "trade_percent": 0.5}`。

---

## 安装与配置

1.  **克隆仓库**
    ```bash
    git clone https://github.com/ITerminaTor996/AI-Trading-Agent.git
    cd AI-Trading-Agent
    ```

2.  **创建并激活虚拟环境** (推荐)
    ```bash
    python -m venv venv
    # Windows
    .\venv\Scripts\activate
    # macOS / Linux
    source venv/bin/activate
    ```

3.  **安装依赖**
    ```bash
    pip install -r requirements.txt
    ```

4.  **设置API密钥**
    - 将 `.env.example` 文件复制一份并重命名为 `.env`。
    - 在 `.env` 文件中填入你的API密钥。目前支持 [DeepSeek](https://platform.deepseek.com/) 和 [NewsAPI](https://newsapi.org/)。
      ```
      DEEPSEEK_API_KEY="sk-your-deepseek-api-key"
      NEWS_API_KEY="your-newsapi-key"
      ```

---

## 使用方法

项目提供了两种主要的运行模式。

### 1. 实时分析模式

直接运行 `main.py` 进入交互式分析模式。程序会提示您输入想分析的股票代码和您的风险偏好。

```bash
python main.py
```

### 2. 回测模式

直接运行 `backtest.py` 来启动回测引擎。回测的参数（如股票代码、回测天数、初始资金等）可以在 `app_config.py` 文件中的 `BACKTEST_CONFIG` 字典里修改。

```bash
python backtest.py
```

在回测结束后，终端会打印出详细的策略表现报告。

---

## 未来优化方向 (Roadmap)

- **统一的程序入口**: 创建一个 `run.py` 命令行工具，可以通过参数（如 `python run.py backtest`）选择不同的运行模式，并传递配置参数。
- **Web用户界面**: 开发一个基于 `Streamlit` 或 `Flask` 的Web界面，让用户可以更直观地进行交互、查看分析图表和回测报告。
- **高级风险管理**: 增强 `RiskAgent` 的功能，例如引入动态止损、移动止损（Trailing Stop-loss）等更复杂的风控规则。
- **多资产投资组合**: 将 `Portfolio` 类升级，使其能够同时管理多种资产（多支股票）的交易和回测。
- **扩展数据源**: 集成更多样化的数据来源，例如主流社交媒体的情绪分析、更详细的宏观经济数据等。